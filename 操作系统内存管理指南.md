# 操作系统内存管理
## 什么是物理内存
我们常说的物理内存大小就是指内存条的大小，但是也要看CPU地址总线的位数。

## 使用物理内存的缺点
1. 单个进程直接操作物理地址，可能破坏系统
2. 多进程运行，多个进程同时操作同一地址空间，产生并发读写问题

## 虚拟内存技术
### 虚拟内存
虚拟出来的内存，确保每个进程都有自己的地址空间，一般是4G。操作系统自动将虚拟地址空间映射到物理地址空间，程序关注的只是虚拟内存，请求的也是虚拟内存，但是真正实用的是物理内存。

### 虚拟内存技术特点
* 大的用户空间：32位虚拟地址可以访问4G
* 部分交换
* 连续性：对连续的虚拟地址来映射物理内存中的不连续的大内存缓冲区
* 安全性：不同进程的虚拟地址彼此隔离

### 虚拟内存如何映射到物理内存
CPU中有一个内存管理单元，MMU(Memory Management Unit)，虚拟内存不是直接送到内存总线，而是先给到MMU，由MMU来把虚拟地址映射到物理地址。

MMU通过页表将虚拟地址转换为物理地址，32位的虚拟地址分成两部分（虚拟页号和偏移量），MMU通过页表找到了虚拟页号对应的物理页号，物理页号+偏移量就是实际的物理地址。

页表的目的就是虚拟页面映射为物理内存的页框，页表可以理解为一个数学函数，函数的输入是虚拟页号，函数的输出是物理页号，通过这个函数可以把虚拟页面映射到物理页号，从而确定物理地址。

内存地址转换，三个步骤：
1. 把虚拟内存地址，切分成页号和偏移量
2. 根据页号，从页表里面，查询对应的物理页号
3. 拿物理地址，加上偏移量，得到物理内存地址
